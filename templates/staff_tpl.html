<link rel="stylesheet" type="text/css" media="screen" href="<{$xoops_url}>/modules/tadtools/bootstrap/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" media="screen" href="<{$xoops_url}>/modules/tadtools/bootstrap/css/bootstrap-responsive.css" />
<link rel="stylesheet" type="text/css" media="screen" href="<{$xoops_url}>/modules/tadtools/css/xoops_adm.css" />
      <div class="row-fluid">
      <h3>職稱設定(配對)</h3>
      <div class="span8" id="tea_div">

      	<h4>教師列表</h4>

      	<{foreach  key=c_key item=teacher    from= $data.teacher_list }>
 
      	       <{if ($data.user_staff_id[$c_key])}>  
      	       		<!-- 已設職稱  -->
      	           <span class="span3"><label  id="tea_<{$c_key}>" title='<{$teacher.name}>' class="label label-inverse">
      	           <{$teacher.name}>_<{ $data.user_staff_job[$c_key]}><span class="del" id="sta_<{$data.user_staff_id[$c_key]}>:tea_<{$c_key}>">
      	           <i class="icon-trash icon-white"></i></span></label>
      	           </span>
      	       <{else}>
      		   <span class="span3"><label  id="tea_<{$c_key}>" title='<{$teacher.name}>' class="label label-success"><{$teacher.name}></label></span>
      		<{/if}> 
      	<{/foreach }>
 
      </div> 
      
      <div class="span3" id="staff_div">
      <h4>職稱</h4>
	<{foreach  key=t_key item=staff_list    from= $data.staff }>
	<{if ($data.staff_user_id[$t_key])}>  
	<label id="sta_<{$t_key}>" title='<{$staff_list}>' class="label label-success" style="display: none;"><{$staff_list}></label>
	<{else}>
	<label id="sta_<{$t_key}>" title='<{$staff_list}>' class="label label-success"><{$staff_list}></label>
	<{/if}>
	<{/foreach }>
 
      </div>
   
      </div>  
      <div class="row-fluid">
      	<p>
            <span class="label label-info">說明</span>
            點選雙邊進行設定班級導師，選擇時呈黃色，設定完成為黑色，教師姓名會隱藏。垃圾桶圖示會還原重新設定。
        </p>  
      </div>
      
      
    <script>
    var label_right='' ;
    var label_left='' ;
    var o_label_right='' ;
    var o_label_left='' ;
    var name='';
    var class_id='';
    
    //右方部份的點選(綠-未選，黃-正在選，黑-已設定不能選)
    $(document).on("click", "#staff_div  label" ,  function(){
          
    	if ($(this).attr("class") == "label label-success" ){
    	   //可選
    	  	$(this).removeClass() ;
        	$(this).addClass('label label-warning') ;
			label_right= $(this).attr("id")  ;
        	name =  $(this).attr("title")  ;
        	if (o_label_right!=''){
        	   	//換選，先前的還原
        		$('#'+o_label_right).removeClass() ;
        		$('#'+o_label_right).addClass('label label-success') ;
        	}
        	o_label_right = $(this).attr("id")  ;
		link() ;
	}else {
		if ($(this).attr("class") == "label label-warning" ){
			//不再選
			$(this).removeClass() ;
			$(this).addClass('label label-success') ;
			label_right= '' ;
			o_label_right ='' ;
        	name = '' ;		
		}
	}
        
    });
    
    //左方部份的點選
    $(document).on("click", "#tea_div label" ,  function(){
    	if ($(this).attr("class") == "label label-success" ){
    	   //可選
    	  	$(this).removeClass() ;
        	$(this).addClass('label label-warning') ;
		label_left= $(this).attr("id")  ;
        	class_id =  $(this).attr("title")  ;
        	if (o_label_left!=''){
        		//換選，先前的還原
        		$('#'+o_label_left).removeClass() ;
        		$('#'+o_label_left).addClass('label label-success') ;
        	}
        	o_label_left = $(this).attr("id")  ;
		link() ;
	}else {
		if ($(this).attr("class") == "label label-warning" ){
			//不再選
			$(this).removeClass() ;
			$(this).addClass('label label-success') ;
			label_left= '' ;
			o_label_left ='' ;
        	class_id = '' ;		
		}
	}    
 

    });   
 
    //作配對，改成黑色，寫入
    function link() {
    	var mark_id ,job ;
          if ((label_right != '') & (label_left!=''))  {
 
           	if (	label_right=='sta_990000')  {
           		//alert(label_right) ;
           		alert('離職人員，會移除校內教師的群組的權限！\n下次再進入設定畫面會消失。') ;
           	}	
             mark_id = label_right +':' + label_left ;
             //取得職稱
             job = $('#'+label_right).attr("title")  ;
             $('#'+label_left).html(class_id +'_'+ name + '<span class="del" id="' + mark_id + '"><i class="icon-trash icon-white"></i></span>')  ;
             $('#'+label_left).addClass('label label-inverse') ;
             //$('#'+label_right).addClass('label label-inverse') ;
             
             //如果第四碼為 1 代表唯一(sta_000101)，要 hide
             var sta_id = label_right.split('_') ;
 			 if (sta_id[1].charAt(3)== '1') {
             	$('#'+label_right).hide() ;
             	label_right ='' ;
             	o_label_right ='' ;
             }	
             
             label_left='' ;
             o_label_left ='' ;
             //設定教師
             //alert(mark_id +job) ;
             ajax_set_teacher(mark_id ,job) ;
          }     
    }      
    
    //把目前有選定的部份先清空
    function clear_now() {
             if (o_label_right!=''){
        		$('#'+o_label_right).removeClass() ;
        		$('#'+o_label_right).addClass('label label-success') ;
             }  
             if (o_label_left!=''){
        		$('#'+o_label_left).removeClass() ;
        		$('#'+o_label_left).addClass('label label-success') ;
             }             
             label_right ='' ;
             o_label_right ='' ;
             label_left='' ;
             o_label_left ='' ;    
    }
    

    
    //消除配對，還原----------------------------------------------------------------------------------
  $(document).on("click", ".del", function(){

    var mark_id = $(this).attr("id")  ;
    var splits = mark_id.split(':') ;
    clear_now() ;

    $('#'+splits[0]).removeClass() ;
    $('#'+splits[0]).addClass('label label-success') ;
    $('#'+splits[0]).show() ;
    $('#'+splits[1]).removeClass() ;
    $('#'+splits[1]).addClass('label label-success') ;  
 
    $('#'+splits[1]).text($('#'+splits[1]).attr("title") ) ;
    //清除教師
    //alert (mark_id) ;
    ajax_del_teacher(mark_id) ;
 
  });
  
      var ajax_set_teacher=function( tid ,tjob ){
      	  //指定教師，寫入
      	  //取得
            var URLs="ajax_set_staff.php" ;
    
            $.ajax({
                url: URLs,
                type:"GET",
                dataType:'text',
				data:{id:tid,job:tjob},
                success: function(msg){
                    //alert(msg);
                },

                 error:function(xhr, ajaxOptions, thrownError){
                    alert('error:' + xhr.status);
                    alert(thrownError);
                 }
           })
        }  
  
      var ajax_del_teacher=function( tid ){
      	  //刪除記錄
            var URLs="ajax_set_staff.php" ;
    
            $.ajax({
                url: URLs,
                type:"GET",
                dataType:'text',
				data:{id:tid,do:"del" },
                success: function(msg){
                   // alert(msg);
                },

                 error:function(xhr, ajaxOptions, thrownError){
                    alert('error:' + xhr.status);
                    alert(thrownError);
                 }
           })
        }  
        
    </script>      